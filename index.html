<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>URSOTV PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --primary: #00d4ff; --bg: #000; --card: #111; --accent: #ff0055; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        /* DASHBOARD */
        #dashboard { 
            display: flex; height: 100vh; flex-direction: column; padding: 20px; box-sizing: border-box; 
            background: radial-gradient(circle at top, #001a2e 0%, #000 100%); align-items: center; justify-content: center;
        }
        .logo-neon { width: 120px; filter: drop-shadow(0 0 15px var(--primary)); margin-bottom: 20px; }
        
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 450px; }
        .menu-item { 
            background: rgba(255,255,255,0.03); border: 1px solid rgba(0, 212, 255, 0.3); 
            border-radius: 12px; padding: 22px 5px; text-align: center; cursor: pointer; transition: 0.2s;
        }
        .menu-item:active { transform: scale(0.95); background: var(--primary); color: #000; }
        .menu-item i { font-size: 24px; display: block; margin-bottom: 8px; }
        .menu-item span { font-size: 12px; font-weight: bold; text-transform: uppercase; }

        /* LISTA */
        #view { display: none; position: fixed; inset: 0; background: #000; flex-direction: column; padding: 15px; z-index: 100; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .search-box { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #111; color: #fff; outline: none; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; overflow-y: auto; flex: 1; }
        .card { background: var(--card); border-radius: 8px; border: 1px solid #222; overflow: hidden; position: relative; }
        .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .card p { font-size: 9px; padding: 5px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* PLAYER */
        #player { position: fixed; inset: 0; background: #000; display: none; z-index: 1000; }
        video { width: 100%; height: 100%; }
        .float-btn { position: absolute; top: 20px; left: 20px; z-index: 1100; padding: 10px 15px; background: var(--primary); color: #000; border: none; border-radius: 5px; font-weight: bold; }

        /* STATUS E RODAP√â */
        #status-bar { margin-top: 20px; font-size: 10px; text-align: center; color: var(--primary); }
        .footer-tools { position: fixed; bottom: 10px; display: flex; gap: 20px; opacity: 0.5; }
        .tool-btn { font-size: 11px; cursor: pointer; border-bottom: 1px solid var(--primary); }
    </style>
</head>
<body>

    <div id="dashboard">
        <img src="logo.png" class="logo-neon" onerror="this.src='https://via.placeholder.com/150/00d4ff/000?text=URSO'">
        <h2 style="color:var(--primary); margin:0 0 25px 0;">URSOTV PRO</h2>
        
        <div class="grid-menu">
            <div class="menu-item" onclick="abrir('CANAIS')"><i>üì∫</i><span>CANAIS</span></div>
            <div class="menu-item" onclick="abrir('FILMES')"><i>üé¨</i><span>FILMES</span></div>
            <div class="menu-item" onclick="abrir('SERIES')"><i>üçø</i><span>S√âRIES</span></div>
            <div class="menu-item" onclick="document.getElementById('f-in').click()"><i>üìÇ</i><span>M3U LOCAL</span></div>
        </div>
        
        <div id="status-bar">Sincronizando...</div>

        <div class="footer-tools">
            <div class="tool-btn" onclick="limparCache()">LIMPAR CACHE</div>
            <div class="tool-btn" onclick="location.reload()">RECARREGAR</div>
        </div>

        <input type="file" id="f-in" style="display:none" accept=".m3u,.m3u8" onchange="carregarLocal(this)">
    </div>

    <div id="view">
        <div class="top-bar">
            <button onclick="voltar()" style="background:none; border:none; color:var(--primary); font-weight:bold; cursor:pointer;">‚ùÆ MENU</button>
            <span id="cat-title" style="font-size: 12px; color: var(--primary);"></span>
        </div>
        <input type="text" class="search-box" placeholder="Pesquisar..." oninput="filtrar(this.value)">
        <div id="main-grid" class="grid"></div>
    </div>

    <div id="player">
        <button class="float-btn" onclick="fecharPlayer()">FECHAR</button>
        <video id="vid" controls></video>
    </div>

<script>
    let dados = { CANAIS: [], FILMES: [], SERIES: [] };
    let catAtual = '';
    const hls = new Hls({ capLevelToPlayerSize: true, accelerateVideo: true });
    const m3uUrl = "https://xcloudcine.xyz/get.php?username=619963334&password=327363322&type=m3u_plus";

    // CARREGAR NUVEM
    async function carregar() {
        const s = document.getElementById('status-bar');
        try {
            const r = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(m3uUrl));
            const t = await r.text();
            if(t.includes("#EXTM3U")) {
                processar(t);
                s.innerText = "SISTEMA ONLINE ‚úÖ";
                localStorage.setItem('cache_m3u', t);
            }
        } catch(e) {
            const cache = localStorage.getItem('cache_m3u');
            if(cache) {
                processar(cache);
                s.innerText = "MODO OFFLINE (CACHE)";
            } else {
                s.innerText = "ERRO DE CONEX√ÉO";
            }
        }
    }

    // CARREGAR LOCAL
    function carregarLocal(input) {
        const file = input.files[0];
        if(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                processar(e.target.result);
                document.getElementById('status-bar').innerText = "LISTA LOCAL ATIVA üìÇ";
                alert("Lista carregada!");
            };
            reader.readAsText(file);
        }
    }

    // PROCESSADOR INTELIGENTE
    function processar(t) {
        dados = { CANAIS: [], FILMES: [], SERIES: [] }; // Reset
        const linhas = t.split('\n');
        for(let i=0; i<linhas.length; i++) {
            if(linhas[i].includes("#EXTINF")) {
                const nome = linhas[i].split(',')[1] || "Sem Nome";
                const logo = linhas[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const url = linhas[i+1]?.trim();
                if(url && url.startsWith("http")) {
                    const item = { nome, logo, url };
                    if(url.includes("movie") || url.includes(".mp4")) dados.FILMES.push(item);
                    else if(url.includes("series") || url.includes(".mkv")) dados.SERIES.push(item);
                    else dados.CANAIS.push(item);
                }
            }
        }
    }

    // INTERFACE
    function abrir(c) {
        catAtual = c;
        if(dados[c].length === 0) return alert("Aguarde o carregamento...");
        document.getElementById('view').style.display = 'flex';
        document.getElementById('cat-title').innerText = c;
        render(dados[c]);
    }

    function render(l) {
        const g = document.getElementById('main-grid');
        g.innerHTML = l.map(i => `
            <div class="card" onclick="play('${i.url}')">
                <img src="${i.logo}" onerror="this.src='https://via.placeholder.com/100x150/111/00d4ff?text=URSO'">
                <p>${i.nome}</p>
            </div>
        `).join('');
    }

    function filtrar(v) {
        const f = dados[catAtual].filter(i => i.nome.toLowerCase().includes(v.toLowerCase()));
        render(f);
    }

    function play(u) {
        document.getElementById('player').style.display = 'block';
        const v = document.getElementById('vid');
        if(Hls.isSupported()) {
            hls.loadSource(u); hls.attachMedia(v);
            hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
        } else { v.src = u; v.play(); }
    }

    function fecharPlayer() {
        document.getElementById('player').style.display = 'none';
        document.getElementById('vid').pause();
        hls.detachMedia();
    }

    function voltar() { document.getElementById('view').style.display = 'none'; }

    function limparCache() {
        localStorage.clear();
        alert("Cache limpo! O app ser√° reiniciado.");
        location.reload();
    }

    // In√≠cio
    carregar();
</script>
</body>
</html>
